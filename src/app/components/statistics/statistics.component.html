<div class="app">
    <main class="content">
        <div class="main-layout">
            <!-- Main Content -->
            <div class="main-content">
                <!-- Search and Chart Section -->
                <div class="search-chart-section">
                    <!-- Search Section -->
                    <div class="search-section">
                        <h2>Search</h2>
                        <div class="search-form">
                            <div class="search-column">
                                <div class="form-group">
                                    <label>Keyword</label>
                                    <input type="text" placeholder="" [(ngModel)]="searchData.keyword">
                                </div>
                                <div class="form-group">
                                    <label>Building</label>
                                    <input type="text" placeholder="" [(ngModel)]="searchData.building">
                                </div>
                                <div class="form-group">
                                    <label>Building Group</label>
                                    <input type="text" placeholder="" [(ngModel)]="searchData.buildingGroup">
                                </div>
                                <div class="form-group">
                                    <label>Device Name</label>
                                    <input type="text" placeholder="" [(ngModel)]="searchData.deviceName">
                                </div>
                            </div>
                            <div class="search-column">
                                <div class="form-group">
                                    <label>City</label>
                                    <input type="text" placeholder="" [(ngModel)]="searchData.city">
                                </div>
                                <div class="form-group">
                                    <label>Zip Code</label>
                                    <input type="text" placeholder="" [(ngModel)]="searchData.zipCode">
                                </div>
                                <div class="form-group">
                                    <label>Tenant</label>
                                    <input type="text" placeholder="" [(ngModel)]="searchData.tenant">
                                </div>
                                <div class="form-group">
                                    <label>Tenant ID</label>
                                    <input type="text" placeholder="" [(ngModel)]="searchData.tenantId">
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Chart Section -->
                    <div class="chart-section">
                        <div class="chart-header">
                            <button class="nav-btn" (click)="previousPeriod()">←</button>
                            <h3>Today's Device Consumption</h3>
                            <button class="nav-btn" (click)="nextPeriod()">→</button>
                        </div>
                        <!-- Loading and Error States -->
                        <div class="chart-loading" *ngIf="loading">
                            <div class="loading-text">Loading today's consumption data...</div>
                        </div>
                        
                        <div class="chart-error" *ngIf="error">
                            <div class="error-text">{{ error }}</div>
                        </div>
                        
                        <div class="chart-container" *ngIf="!loading && !error">
                            <canvas id="waterChart" width="600" height="250"></canvas>
                        </div>
                    </div>
                </div>

                <!-- Parallel Layout: Building Groups and Statistics -->
                <div class="parallel-sections">
                    <!-- Building Groups Table -->
                    <div class="building-groups-section">
                        <h3>Building Groups</h3>
                        <div class="box">
                            <div class="table-container">
                                <table class="data-table">
                                    <thead>
                                        <tr>
                                            <th>#</th>
                                            <th>Group</th>
                                            <th>Buildings</th>
                                            <th>Apartments</th>
                                            <th>Devices</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <tr *ngFor="let group of paginatedBuildingGroups; let i = index" 
                                            (click)="onBuildingGroupRowClick(i)" 
                                            [class.selected]="selectedBuildingGroupRow === i">
                                            <td>{{ (currentGroupPage - 1) * itemsPerPage + i + 1 }}</td>
                                            <td>{{ group.name }}</td>
                                            <td>{{ group.buildingCount }}</td>
                                            <td>{{ group.apartmentCount }}</td>
                                            <td>{{ group.deviceCount }}</td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                            
                            <!-- Building Groups Pagination - moved to bottom -->
                            <div class="pagination-inline" *ngIf="buildingGroupTotalPages > 1">
                                <div class="pagination-info">
                                    Showing {{ (currentGroupPage - 1) * itemsPerPage + 1 }}-{{ Math.min(currentGroupPage * itemsPerPage, buildingGroupTotalItems) }} of {{ buildingGroupTotalItems }} groups
                                </div>
                                <div class="pagination-controls">
                                    <button class="pagination-btn" 
                                            [disabled]="currentGroupPage === 1" 
                                            (click)="onBuildingGroupPageChange(currentGroupPage - 1)">
                                        ‹
                                    </button>
                                    <button *ngFor="let page of getBuildingGroupPageNumbers()" 
                                            class="pagination-btn" 
                                            [class.active]="page === currentGroupPage"
                                            (click)="onBuildingGroupPageChange(page)">
                                        {{ page }}
                                    </button>
                                    <button class="pagination-btn" 
                                            [disabled]="currentGroupPage === buildingGroupTotalPages" 
                                            (click)="onBuildingGroupPageChange(currentGroupPage + 1)">
                                        ›
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Statistics Section -->
                    <div class="stats-section">
                        <h3>Export</h3>
                        <div class="box">
                            <div class="stats-content-layout">
                                <!-- Left Side - Statistics -->
                                <div class="stats-left">
                                    <div class="stat-item">
                                        <span class="stat-label">Today:</span>
                                        <span class="stat-value">123 Liter</span>
                                    </div>
                                    <div class="stat-item">
                                        <span class="stat-label">Yesterday:</span>
                                        <span class="stat-value">230 Liter</span>
                                    </div>
                                    <div class="stat-item">
                                        <span class="stat-label">this week:</span>
                                        <span class="stat-value">899 Liter</span>
                                    </div>
                                    <div class="stat-item">
                                        <span class="stat-label">this Month:</span>
                                        <span class="stat-value">22 m3</span>
                                    </div>
                                    <div class="stat-item">
                                        <span class="stat-label">this Year:</span>
                                        <span class="stat-value">342m3</span>
                                    </div>
                                    <div class="stat-item">
                                        <span class="stat-label">last year:</span>
                                        <span class="stat-value">388m3</span>
                                    </div>
                                </div>
                                
                                    <!-- Right Side - Period and Buttons -->
                                    <div class="stats-right">
                                        <div class="period-inputs">
                                            <div class="form-group">
                                                <label>Period from</label>
                                                <input type="text" placeholder="" [(ngModel)]="periodFrom">
                                            </div>
                                            <div class="form-group">
                                                <label>Period to</label>
                                                <input type="text" placeholder="" [(ngModel)]="periodTo">
                                            </div>
                                            <button class="btn btn-primary" (click)="resetPeriod()">
                                                Reset Period
                                            </button>
                                        </div>

                                        <div class="export-buttons">
                                            <button class="btn btn-primary" (click)="exportPDF()">
                                                Export PDF
                                            </button>
                                            <button class="btn btn-primary" (click)="exportXLS()">
                                                Export XLS
                                            </button>
                                        </div>
                                    </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Building and Apartment Tables -->
                <div class="building-apartment-layout">
                    <!-- Building Table -->
                    <div class="building-section">
                        <h3>Building</h3>
                        <div class="box">
                            <div class="table-container">
                                <table class="data-table">
                                    <thead>
                                        <tr>
                                            <th>#</th>
                                            <th>Building</th>
                                            <th>Apartments</th>
                                            <th>Devices</th>
                                            <th>Address</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <tr *ngFor="let building of paginatedBuildings; let i = index" 
                                            (click)="onBuildingRowClick(i)" 
                                            [class.selected]="selectedBuildingRow === i">
                                            <td>{{ (currentBuildingPage - 1) * itemsPerPage + i + 1 }}</td>
                                            <td>{{ building.name }}</td>
                                            <td>{{ building.apartmentCount }}</td>
                                            <td>{{ building.deviceCount }}</td>
                                            <td>{{ building.address }}</td>
                                        </tr>
                                    </tbody>
                                </table>
                                
                                <!-- Building Pagination -->
                                <div class="pagination-inline" *ngIf="buildingTotalPages > 1">
                                    <div class="pagination-info">
                                        Showing {{ (currentBuildingPage - 1) * itemsPerPage + 1 }}-{{ Math.min(currentBuildingPage * itemsPerPage, buildingTotalItems) }} of {{ buildingTotalItems }} buildings
                                    </div>
                                    <div class="pagination-controls">
                                        <button class="pagination-btn" 
                                                [disabled]="currentBuildingPage === 1" 
                                                (click)="onBuildingPageChange(currentBuildingPage - 1)">
                                            ‹
                                        </button>
                                        <button *ngFor="let page of getBuildingPageNumbers()" 
                                                class="pagination-btn" 
                                                [class.active]="page === currentBuildingPage"
                                                (click)="onBuildingPageChange(page)">
                                            {{ page }}
                                        </button>
                                        <button class="pagination-btn" 
                                                [disabled]="currentBuildingPage === buildingTotalPages" 
                                                (click)="onBuildingPageChange(currentBuildingPage + 1)">
                                            ›
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Apartment Table -->
                    <div class="apartment-section">
                        <h3>Apartment</h3>
                        <div class="box">
                            <div class="table-container">
                                <table class="data-table">
                                    <thead>
                                        <tr>
                                            <th>#</th>
                                            <th>Apartment</th>
                                            <th>Tenant</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <tr *ngFor="let apartment of apartmentGridData; let i = index" 
                                            (click)="onApartmentRowClick(i)" 
                                            [class.selected]="selectedApartmentRow === i">
                                            <td>{{ (apartmentCurrentPage - 1) * itemsPerPage + i + 1 }}</td>
                                            <td>{{ apartment.apartment }}</td>
                                            <td>{{ apartment.tenant }}</td>
                                        </tr>
                                    </tbody>
                                </table>
                                
                                <!-- Apartment Pagination -->
                                <div class="pagination-inline" *ngIf="apartmentTotalPages > 1">
                                    <div class="pagination-info">
                                        Showing {{ (apartmentCurrentPage - 1) * itemsPerPage + 1 }}-{{ Math.min(apartmentCurrentPage * itemsPerPage, apartmentTotalItems) }} of {{ apartmentTotalItems }} apartments
                                    </div>
                                    <div class="pagination-controls">
                                        <button class="pagination-btn" 
                                                [disabled]="apartmentCurrentPage === 1" 
                                                (click)="onApartmentPageChange(apartmentCurrentPage - 1)">
                                            ‹
                                        </button>
                                        <button *ngFor="let page of getApartmentPageNumbers()" 
                                                class="pagination-btn" 
                                                [class.active]="page === apartmentCurrentPage"
                                                (click)="onApartmentPageChange(page)">
                                            {{ page }}
                                        </button>
                                        <button class="pagination-btn" 
                                                [disabled]="apartmentCurrentPage === apartmentTotalPages" 
                                                (click)="onApartmentPageChange(apartmentCurrentPage + 1)">
                                            ›
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </main>
</div>
