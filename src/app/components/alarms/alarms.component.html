<div class="app">
    <main class="content">
        <!-- Alarm Summary Section -->
        <div class="alarm-summary">
            <!-- Major Alarms -->
            <div class="alarm-section major-alarms-section">
                <h3>Major Alarms</h3>
                <div class="summary-panel major-alarms">
                    <!-- Loading State for Major Alarms -->
                    <div *ngIf="loading" class="box-loading-state">
                        <div class="loading-spinner"></div>
                        <span>Loading alarm categories...</span>
                    </div>
                    
                    <!-- Error State for Major Alarms -->
                    <div *ngIf="error" class="box-error-state">
                        <span>{{ error }}</span>
                        <button (click)="loadAlarmCategories()" class="retry-button">Retry</button>
                    </div>
                    
                    <!-- Data Display for Major Alarms -->
                    <div *ngIf="alarmCategories && !loading && !error" class="alarm-stats">
                        <div class="stat-item">
                            <span class="stat-label">Major Leaks</span>
                            <span class="stat-value highlight">{{ alarmCategories.major.major_leaks }}</span>
                        </div>
                        <div class="stat-item">
                            <span class="stat-label">auto shut-off non resolved</span>
                            <span class="stat-value highlight">{{ alarmCategories.major.auto_shutoff_non_resolved }}</span>
                        </div>
                        <div class="stat-item">
                            <span class="stat-label">Low Temperature</span>
                            <span class="stat-value highlight">{{ alarmCategories.major.low_temperature }}</span>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Minor Alarms -->
            <div class="alarm-section minor-alarms-section">
                <h3>Minor Alarms</h3>
                <div class="summary-panel minor-alarms">
                    <!-- Loading State for Minor Alarms -->
                    <div *ngIf="loading" class="box-loading-state">
                        <div class="loading-spinner"></div>
                        <span>Loading alarm categories...</span>
                    </div>
                    
                    <!-- Error State for Minor Alarms -->
                    <div *ngIf="error" class="box-error-state">
                        <span>{{ error }}</span>
                        <button (click)="loadAlarmCategories()" class="retry-button">Retry</button>
                    </div>
                    
                    <!-- Data Display for Minor Alarms -->
                    <div *ngIf="alarmCategories && !loading && !error" class="alarm-stats">
                        <div class="stat-item">
                            <span class="stat-label">Medium Leaks</span>
                            <span class="stat-value highlight">{{ alarmCategories.minor.medium_leaks }}</span>
                        </div>
                        <div class="stat-item">
                            <span class="stat-label">Minor Leaks</span>
                            <span class="stat-value highlight">{{ alarmCategories.minor.minor_leaks }}</span>
                        </div>
                    </div>
                </div>
            </div>

            <!-- System Messages -->
            <div class="alarm-section system-messages-section">
                <h3>System Messages</h3>
                <div class="summary-panel system-messages">
                    <!-- Loading State for System Messages -->
                    <div *ngIf="loading" class="box-loading-state">
                        <div class="loading-spinner"></div>
                        <span>Loading alarm categories...</span>
                    </div>
                    
                    <!-- Error State for System Messages -->
                    <div *ngIf="error" class="box-error-state">
                        <span>{{ error }}</span>
                        <button (click)="loadAlarmCategories()" class="retry-button">Retry</button>
                    </div>
                    
                    <!-- Data Display for System Messages -->
                    <div *ngIf="alarmCategories && !loading && !error" class="alarm-stats">
                        <div class="stat-item">
                            <span class="stat-label">Wifi Connection Lost</span>
                            <span class="stat-value" [class.highlight]="alarmCategories.system.wifi_connection_lost > 0">{{ alarmCategories.system.wifi_connection_lost }}</span>
                        </div>
                        <div class="stat-item">
                            <span class="stat-label">Power Loss</span>
                            <span class="stat-value" [class.highlight]="alarmCategories.system.power_loss > 0">{{ alarmCategories.system.power_loss }}</span>
                        </div>
                        <div class="stat-item">
                            <span class="stat-label">Valve Failure</span>
                            <span class="stat-value" [class.highlight]="alarmCategories.system.valve_failure > 0">{{ alarmCategories.system.valve_failure }}</span>
                        </div>
                        <div class="stat-item">
                            <span class="stat-label">poor Wifi</span>
                            <span class="stat-value" [class.highlight]="alarmCategories.system.poor_wifi > 0">{{ alarmCategories.system.poor_wifi }}</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Message Board Section -->
        <div class="message-board-section">
            <h2>Message Board</h2>
            <div class="table-container">
                <table class="message-table">
                    <thead>
                        <tr>
                            <th>#</th>
                            <th>Building</th>
                            <th>Address</th>
                            <th>Apartment</th>
                            <th>Tenant</th>
                            <th>Alarm</th>
                            <th>Message</th>
                            <th>Action</th>
                            <th class="action-header">
                                <button class="pill outline" (click)="unhideAllAlarms()">Unhide Alarm</button>
                            </th>
                        </tr>
                    </thead>
                    <tbody>
                        <!-- Loading State -->
                        <tr *ngIf="loading">
                            <td colspan="9" class="loading-cell">
                                <div class="table-loading-state">
                                    <div class="loading-spinner"></div>
                                    <span>Loading alarms...</span>
                                </div>
                            </td>
                        </tr>
                        
                        <!-- Error State -->
                        <tr *ngIf="error">
                            <td colspan="9" class="error-cell">
                                <div class="table-error-state">
                                    <span>{{ error }}</span>
                                    <button (click)="loadAlarms()" class="retry-button">Retry</button>
                                </div>
                            </td>
                        </tr>
                        
                        <!-- No Data State -->
                        <tr *ngIf="!loading && !error && paginatedAlarms.length === 0">
                            <td colspan="9" class="no-data-cell">
                                <div class="no-data-state">
                                    <span>No alarms found</span>
                                </div>
                            </td>
                        </tr>
                        
                        <!-- Dynamic Alarm Rows -->
                        <tr *ngFor="let alarm of paginatedAlarms; let i = index" 
                            class="alarm-row" 
                            [class.critical]="alarm.alarm_severity === 'high'"
                            [class.selected]="selectedRow === i"
                            (click)="onRowClick(i)">
                            <td>{{ (currentPage - 1) * itemsPerPage + i + 1 }}</td>
                            <td>{{ alarm.building_name || 'N/A' }}</td>
                            <td>{{ alarm.building_address || 'N/A' }}</td>
                            <td>{{ alarm.device_name || 'N/A' }}</td>
                            <td>{{ alarm.device_serial || 'N/A' }}</td>
                            <td>
                                <span class="alarm-badge" 
                                      [class.major]="alarm.alarm_severity === 'high'"
                                      [class.medium]="alarm.alarm_severity === 'medium'"
                                      [class.low-temp]="alarm.alarm_type_name && alarm.alarm_type_name.toLowerCase().includes('temp')"
                                      [class.micro]="alarm.alarm_severity === 'low'">
                                    {{ alarm.alarm_type_name || 'Unknown' }}
                                </span>
                            </td>
                            <td>{{ alarm.message || 'No message' }}</td>
                            <td>{{ alarm.status || 'None' }}</td>
                            <td class="actions">
                                <button class="pill" (click)="showDetails($event)">Details</button>
                                <button class="pill outline" (click)="hideAlarm($event)">Hide Alarm</button>
                            </td>
                        </tr>
                    </tbody>
                </table>
                
                <!-- Pagination Controls - Inside the grid container -->
                <div *ngIf="!loading && !error && totalPages > 1" class="pagination-container">
                    <div class="pagination-info">
                        <span>Showing {{ (currentPage - 1) * itemsPerPage + 1 }} to {{ Math.min(currentPage * itemsPerPage, totalItems) }} of {{ totalItems }} alarms</span>
                    </div>
                    
                    <div class="pagination-controls">
                        <button class="pagination-btn" 
                                [disabled]="currentPage === 1" 
                                (click)="previousPage()"
                                title="Previous Page">
                            ‹
                        </button>
                        
                        <button *ngFor="let page of getPageNumbers()" 
                                class="pagination-btn" 
                                [class.active]="page === currentPage"
                                (click)="goToPage(page)">
                            {{ page }}
                        </button>
                        
                        <button class="pagination-btn" 
                                [disabled]="currentPage === totalPages" 
                                (click)="nextPage()"
                                title="Next Page">
                            ›
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </main>
</div>
