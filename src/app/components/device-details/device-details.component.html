<div class="app">
    <main class="content">
        <!-- Search and Device Info Section -->
        <div class="search-device-section">
            <!-- Search Section -->
            <div class="search-section">
                <h2>Search</h2>
                <div class="search-form">
                    <div class="search-column">
                        <div class="form-group">
                            <label>Keyword</label>
                            <input type="text" placeholder="Search across all data..." [(ngModel)]="searchData.keyword" (input)="onSearch()">
                        </div>
                        <div class="form-group">
                            <label>Building</label>
                            <input type="text" placeholder="Filter by building name..." [(ngModel)]="searchData.building" (input)="onSearch()">
                        </div>
                        <div class="form-group">
                            <label>Building Group</label>
                            <input type="text" placeholder="Filter by group name..." [(ngModel)]="searchData.buildingGroup" (input)="onSearch()">
                        </div>
                        <div class="form-group">
                            <label>Device Name</label>
                            <input type="text" placeholder="Filter by device name..." [(ngModel)]="searchData.deviceName" (input)="onSearch()">
                        </div>
                    </div>
                    <div class="search-column">
                        <div class="form-group">
                            <label>City</label>
                            <input type="text" placeholder="Filter by city..." [(ngModel)]="searchData.city" (input)="onSearch()">
                        </div>
                        <div class="form-group">
                            <label>Zip Code</label>
                            <input type="text" placeholder="Filter by zip code..." [(ngModel)]="searchData.zipCode" (input)="onSearch()">
                        </div>
                        <div class="form-group">
                            <label>Tenant</label>
                            <input type="text" placeholder="Filter by tenant name..." [(ngModel)]="searchData.tenant" (input)="onSearch()">
                        </div>
                        <div class="form-group">
                            <label>Tenant ID</label>
                            <input type="text" placeholder="Filter by tenant ID..." [(ngModel)]="searchData.tenantId" (input)="onSearch()">
                        </div>
                    </div>
                </div>
            </div>

            <!-- Device Information Section -->
            <div class="device-info-section">
                <h2>Device Details</h2>
                <div class="device-info-panel">
                    <div class="device-details">
                        <div class="device-field">
                            <span class="device-label">Device Name:</span>
                            <span class="device-value">{{ deviceDetails?.name || 'Compteur Eau Principal' }}</span>
                        </div>
                        <div class="device-field">
                            <span class="device-label">Serial Number:</span>
                            <span class="device-value">{{ deviceDetails?.serial || 'SM-001-001' }}</span>
                        </div>
                    </div>
                    <div class="device-actions">
                        <button class="pill" (click)="assignToNewLocation()">Assign to New Location</button>
                        <button class="pill outline" (click)="unassignDevice()">Unassign</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Middle Section with Building Groups, Building, and Apartment -->
        <div class="middle-section">
            <!-- Left Column: Building Groups and Building -->
            <div class="left-column">
                <!-- Building Groups Section -->
                <div class="building-groups-section">
                    <h3>Building Groups</h3>
                    <div class="groups-panel">
                        <table class="data-table">
                            <thead>
                                <tr>
                                    <th>#</th>
                                    <th>Group</th>
                                    <th>Building</th>
                                    <th>Zip Code</th>
                                    <th>Address</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr *ngFor="let group of buildingGroups; let i = index" 
                                    (click)="onGroupRowClick(i)" 
                                    [class.selected]="selectedGroupRow === i">
                                    <td>{{ (currentGroupPage - 1) * itemsPerPage + i + 1 }}</td>
                                    <td>{{ group.name || 'Groupe Immobilier Paris Centre' }}</td>
                                    <td>{{ group.address || 'Résidence Vendôme' }}</td>
                                    <td>{{ group.address?.split(',')[1]?.trim() || '75001' }}</td>
                                    <td>{{ group.address || '15 Place Vendôme, 75001 Paris' }}</td>
                                </tr>
                            </tbody>
                        </table>
                        
                        <!-- Pagination for Building Groups -->
                        <div class="pagination-inline" *ngIf="buildingGroupTotalPages > 1">
                            <div class="pagination-info">
                                Showing {{ (currentGroupPage - 1) * itemsPerPage + 1 }}-{{ Math.min(currentGroupPage * itemsPerPage, buildingGroupTotalItems) }} of {{ buildingGroupTotalItems }} groups
                            </div>
                            <div class="pagination-controls">
                                <button class="pagination-btn" 
                                        [disabled]="currentGroupPage === 1" 
                                        (click)="onGroupPageChange(currentGroupPage - 1)">
                                    ‹
                                </button>
                                <button *ngFor="let page of getGroupPageNumbers()" 
                                        class="pagination-btn" 
                                        [class.active]="page === currentGroupPage"
                                        (click)="onGroupPageChange(page)">
                                    {{ page }}
                                </button>
                                <button class="pagination-btn" 
                                        [disabled]="currentGroupPage === buildingGroupTotalPages" 
                                        (click)="onGroupPageChange(currentGroupPage + 1)">
                                    ›
                                </button>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Building Section -->
                <div class="building-section">
                    <h3>Building</h3>
                    <div class="building-panel">
                        <table class="data-table">
                            <thead>
                                <tr>
                                    <th>#</th>
                                    <th>Building Name</th>
                                    <th>Address</th>
                                    <th>Zip Code</th>
                                    <th>Apartment</th>
                                    <th>Tenant</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr *ngFor="let building of buildings; let i = index" 
                                    (click)="onBuildingRowClick(i)" 
                                    [class.selected]="selectedBuildingRow === i">
                                    <td>{{ (currentBuildingPage - 1) * itemsPerPage + i + 1 }}</td>
                                    <td>{{ building.name || 'Résidence Vendôme' }}</td>
                                    <td>{{ building.address || '15 Place Vendôme, 75001 Paris' }}</td>
                                    <td>{{ building.zip_code || building.address?.split(',')[1]?.trim() || '75001' }}</td>
                                    <td>{{ building.apartmentAddress || 'Apt 101, 15 Place Vendôme' }}</td>
                                    <td>{{ building.tenantName || 'Marie Dubois' }}</td>
                                </tr>
                            </tbody>
                        </table>
                        
                        <!-- Pagination for Buildings -->
                        <div class="pagination-inline" *ngIf="buildingTotalPages > 1">
                            <div class="pagination-info">
                                Showing {{ (currentBuildingPage - 1) * itemsPerPage + 1 }}-{{ Math.min(currentBuildingPage * itemsPerPage, buildingTotalItems) }} of {{ buildingTotalItems }} buildings
                            </div>
                            <div class="pagination-controls">
                                <button class="pagination-btn" 
                                        [disabled]="currentBuildingPage === 1" 
                                        (click)="onBuildingPageChange(currentBuildingPage - 1)">
                                    ‹
                                </button>
                                <button *ngFor="let page of getBuildingPageNumbers()" 
                                        class="pagination-btn" 
                                        [class.active]="page === currentBuildingPage"
                                        (click)="onBuildingPageChange(page)">
                                    {{ page }}
                                </button>
                                <button class="pagination-btn" 
                                        [disabled]="currentBuildingPage === buildingTotalPages" 
                                        (click)="onBuildingPageChange(currentBuildingPage + 1)">
                                    ›
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Right Column: Apartment -->
            <div class="right-column">
                <!-- Apartment Section -->
                <div class="apartment-section">
                    <h3>Apartment</h3>
                    <div class="apartment-panel">
                        <table class="data-table">
                            <thead>
                                <tr>
                                    <th>#</th>
                                    <th>Apartment</th>
                                    <th>Tenant</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr *ngFor="let apartment of apartments; let i = index" 
                                    (click)="onApartmentRowClick(i)" 
                                    [class.selected]="selectedApartmentRow === i">
                                    <td>{{ (currentApartmentPage - 1) * itemsPerPage + i + 1 }}</td>
                                    <td>{{ apartment.name || 'Apt 101' }}</td>
                                    <td>{{ apartment.tenantName || 'Marie Dubois' }}</td>
                                </tr>
                            </tbody>
                        </table>
                        
                        <!-- Pagination for Apartments -->
                        <div class="pagination-inline" *ngIf="apartmentTotalPages > 1">
                            <div class="pagination-info">
                                Showing {{ (currentApartmentPage - 1) * itemsPerPage + 1 }}-{{ Math.min(currentApartmentPage * itemsPerPage, apartmentTotalItems) }} of {{ apartmentTotalItems }} apartments
                            </div>
                            <div class="pagination-controls">
                                <button class="pagination-btn" 
                                        [disabled]="currentApartmentPage === 1" 
                                        (click)="onApartmentPageChange(currentApartmentPage - 1)">
                                    ‹
                                </button>
                                <button *ngFor="let page of getApartmentPageNumbers()" 
                                        class="pagination-btn" 
                                        [class.active]="page === currentApartmentPage"
                                        (click)="onApartmentPageChange(page)">
                                    {{ page }}
                                </button>
                                <button class="pagination-btn" 
                                        [disabled]="currentApartmentPage === apartmentTotalPages" 
                                        (click)="onApartmentPageChange(currentApartmentPage + 1)">
                                    ›
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Unassigned Devices Section -->
        <div class="unassigned-devices-section">
            <div class="unassigned-header">
                <h3>Unassigned Devices</h3>
                <button class="pill" (click)="findNewDevice()">Find New Device</button>
            </div>
            <div class="unassigned-panel">
                <table class="data-table">
                    <thead>
                        <tr>
                            <th>#</th>
                            <th>Serial Number</th>
                            <th>Last Device Name</th>
                            <th>Last Address</th>
                            <th>Last Apartment</th>
                            <th>Last Tenant</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr *ngFor="let device of unassignedDevices; let i = index" 
                            (click)="onUnassignedRowClick(i)" 
                            [class.selected]="selectedUnassignedRow === i">
                            <td>{{ (currentUnassignedPage - 1) * itemsPerPage + i + 1 }}</td>
                            <td>{{ device.serial || 'SM-UN-001' }}</td>
                            <td>{{ device.lastDeviceName || 'Compteur Eau Ancien' }}</td>
                            <td>{{ device.lastAddress || '15 Place Vendôme, 75001 Paris' }}</td>
                            <td>{{ device.lastApartment || 'Apt 101' }}</td>
                            <td>{{ device.lastTenant || 'Marie Dubois' }}</td>
                        </tr>
                    </tbody>
                </table>
                
                <!-- Pagination for Unassigned Devices -->
                <div class="pagination-inline" *ngIf="unassignedTotalPages > 1">
                    <div class="pagination-info">
                        Showing {{ (currentUnassignedPage - 1) * itemsPerPage + 1 }}-{{ Math.min(currentUnassignedPage * itemsPerPage, unassignedTotalItems) }} of {{ unassignedTotalItems }} devices
                    </div>
                    <div class="pagination-controls">
                        <button class="pagination-btn" 
                                [disabled]="currentUnassignedPage === 1" 
                                (click)="onUnassignedPageChange(currentUnassignedPage - 1)">
                            ‹
                        </button>
                        <button *ngFor="let page of getUnassignedPageNumbers()" 
                                class="pagination-btn" 
                                [class.active]="page === currentUnassignedPage"
                                (click)="onUnassignedPageChange(page)">
                            {{ page }}
                        </button>
                        <button class="pagination-btn" 
                                [disabled]="currentUnassignedPage === unassignedTotalPages" 
                                (click)="onUnassignedPageChange(currentUnassignedPage + 1)">
                            ›
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <!-- Find Device Modal -->
    <app-find-device-modal
        [isVisible]="showFindDeviceModal"
        [isLoading]="findDeviceLoading"
        (assign)="onFindDeviceAssign($event)"
        (cancel)="onFindDeviceCancel()">
    </app-find-device-modal>

    <!-- Device Details Modal -->
    <app-device-details-modal
        [isVisible]="showDeviceDetailsModal"
        [deviceDetails]="selectedDevice"
        (close)="onDeviceDetailsClose()"
        (edit)="onDeviceDetailsEdit()">
    </app-device-details-modal>

    <!-- Assign Location Modal -->
    <app-assign-location-modal
        [isVisible]="showAssignLocationModal"
        [deviceName]="selectedDevice?.name || ''"
        [deviceSerial]="selectedDevice?.serial || ''"
        (close)="onAssignLocationClose()"
        (assign)="onAssignLocation($event)">
    </app-assign-location-modal>

    <!-- Unassign Device Modal -->
    <app-unassign-device-modal
        [isVisible]="showUnassignDeviceModal"
        [deviceName]="selectedDevice?.name || ''"
        [deviceSerial]="selectedDevice?.serial || ''"
        [currentLocation]="selectedDevice?.location || ''"
        [currentApartment]="selectedDevice?.apartment || ''"
        [currentTenant]="selectedDevice?.tenant || ''"
        (close)="onUnassignDeviceClose()"
        (unassign)="onUnassignDevice($event)">
    </app-unassign-device-modal>
</div>
